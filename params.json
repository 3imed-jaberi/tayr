{
  "name": "Tayr",
  "tagline": "an easy on-the-fly ORM for NodeJS, inspired by RedBeanPHP",
  "body": "# Introduction\r\n- Feeling that you are are wasting a lot of time writing database schema ?\r\n- Bored of making migrations for every little change in the database ?\r\n- Feeling that there is an other way simpler to manage a database ?\r\n- Wanting an orm that does all the configuration for you ?\r\n\r\nTayr is what you're looking for. It's a MySql ORM that needs \"zero-config\", It makes the database schema and updates automatically, and let you focus on your code without carrying on models and migrations...\r\n\r\n## Install\r\nInstall the module with:\r\n\r\n    npm install Tayr\r\n\r\n## Connect to DB\r\nThe way to connect to DB is quite similar to mysql module:\r\n\r\n```javascript\r\n    var nest = require('Tayr');\r\n    var T = new nest({\r\n        host: 'hostname',\r\n        user: 'username',\r\n        password: 'password',\r\n        database: 'databaseName'\r\n    });\r\n```\r\n# CRUD\r\n## Initialize a tayr\r\nTo declare a tayr:\r\n\r\n- `tayr(table,properties)`\r\n\r\n    **Arguments:**\r\n\r\n    table: *[string] (required)* the table name in which you want to store the tayr.\r\n\r\n    properties: *[object]* an object with the tayr properties.\r\n\r\n    ```javascript\r\n    var user = new T.tayr('user',{\r\n        name: 'Muhamad',\r\n        age: 63,\r\n        registeredAt: new Date()\r\n    });\r\n    ```\r\n### Change tayr table\r\nYou can access and change a tayr table by its `table` property:\r\n```javascript\r\nconsole.log(user.table);\r\n// output: user\r\n```\r\n\r\n## Create/Update\r\nCreating and updating is done using `.store()` function, if the tayr has an `id` that exists in the table it will update the row, else it will add a new row and affect an `id` to the tayr.\r\n```javascript\r\n    user.store().then(function(){\r\n        console.log(user);\r\n    });\r\n    //output: { name: 'Muhamad', age: '63', registeredAt: 1467137605631, id: 6 }\r\n```\r\nYou can now modify the user tayr and store it to update the row:\r\n\r\n```javascript\r\n    user.store().then(function(){\r\n        user.name = 'Omar';\r\n        user.age = 53;\r\n        user.store(function(){\r\n            console.log(user);\r\n        });\r\n    });\r\n    //output: { name: 'Omar', age: '53', registeredAt: 1467137605631, id: 6 }\r\n```\r\n### Store multiple tayrs\r\nThere are two ways to store multiple tayrs at the same time:\r\n\r\n- `storeMultiple(tayrs)`: Stores the given tayr.\r\n\r\n    **Arguments:**\r\n\r\n    tayrs: *[arrayOfTayrs]* The tayrs to be stored.\r\n\r\n    ```javascript\r\n    var tayrs = [\r\n        new T.tayr('tag',{text:'orm'}),\r\n        new T.tayr('user',{name:'AbuBakr',age:36}),\r\n        new T.tayr('user',{name:'Ussama',age:44}),\r\n    ];\r\n    T.storeMultiple(tayrs).then(function(res){\r\n        console.log(res);\r\n    });\r\n    //output: [ { text: 'orm', id: 1 }, { name: 'AbuBakr', age: 36, id: 7 }, { name: 'Ussama', age: 44, id: 8 } ]\r\n    ```\r\n- `storeRows(table,array)`: This function is faster but it stores the rows in one table, that means that the tayrs can't have different tables:\r\n\r\n    **Arguments:**\r\n\r\n    table: *[string]* The table in which tayrs will be stored.\r\n\r\n    array: *[array]* The objects to be stored.\r\n\r\n    ```javascript\r\n        var comments = [\r\n            {text: 'I like it',posted: new Date()},\r\n            {text: 'wonderful',posted: new Date()},\r\n        ];\r\n        T.storeRows('comment',comments).then(function(res){\r\n            console.log(res);\r\n        });\r\n        // output: [ { text: 'I like it', posted: 1467397814583, id: 1 },\r\n        // { text: 'wonderful', posted: 1467397814583, id: 2 } ]\r\n    ```\r\n*Note That: In Both Functions if any row exists it will be updated*\r\n\r\n## Read\r\nTo read data from DB there are 3 ways:\r\n\r\n- `load(table,id)`: Loads a tayr.\r\n\r\n    **Arguments:**\r\n\r\n    table: *[string] (required)* The table of the wanted tayr.\r\n\r\n    id: *[integer] (required)* The id of the wanted tayr.\r\n\r\n    ```javascript\r\n        T.load('user',6).then(function(user){\r\n            console.log(user);\r\n        });\r\n        // output: { name: 'Omar', age: '53', registeredAt: 1467137605631, id: 6 }\r\n    ```\r\n    *If no record found it returns false*\r\n- `find(table,data)`: this function returns an array of tayrs from a table.\r\n\r\n    **Arguments:**\r\n\r\n    table: *[string] (required)* The table of the wanted tayr.\r\n\r\n    data: *[object]*\r\n    - sql: *[string]* All the sql you want to put after \"WHERE\" *(It's recommended to not put variables in this string, write `?` instead)*\r\n    - vals: *[array|simple]* The values that will replace the `?`s in order\r\n    - parents: *[array|string]* The parents to join with the tayr\r\n    - select: *[string]* String added after \"SELECT\"\r\n    - manualSelect: *[boolean]* If set to true request will not select all table columns automatically *|| Default: children+'s'*\r\n\r\n    ```javascript\r\n        T.find('user',{sql:'age > ?',vals: 40}).then(function(users) {\r\n            console.log(users);\r\n        });\r\n        // output: [ { id: 6, name: 'Omar', age: '53', registeredAt: 2147483647 },\r\n        // { id: 8, name: 'Ussama', age: '44', registeredAt: null } ]\r\n    ```\r\n    If you want to **find all** rows, don't put conditions:\r\n\r\n    ```javascript\r\n        T.find('user').then(function(users) {\r\n            console.log(users);\r\n        });\r\n        // output: [ { id: 6, name: 'Omar', age: '53', registeredAt: 2147483647 },\r\n        // { id: 7, name: 'AbuBakr', age: '36', registeredAt: null },\r\n        // { id: 8, name: 'Ussama', age: '44', registeredAt: null } ]\r\n    ```\r\n    To get only some columns:\r\n\r\n    ```javascript\r\n        T.find('user',{sql:'age > ?',vals: 40,select: 'name,id',manualSelect: true}).then(function(users) {\r\n            console.log(users);\r\n        });\r\n        // output: [ { id: 6, name: 'Omar' },\r\n        // { id: 8, name: 'Ussama' } ]\r\n    ```\r\n- `findOne(table,data)`: this function works the same as `find` but returns only one tayr:\r\n\r\n    ```javascript\r\n        T.findOne('user',{sql:'age > ?',vals: 40}).then(function(user) {\r\n            console.log(user);\r\n        });\r\n        // output: { id: 6, name: 'Omar', age: '53', registeredAt: 2147483647 }\r\n    ```\r\n## Delete\r\nThere are two ways to delete records from DB:\r\n\r\n- `.delete()`: this function deletes the tayr:\r\n\r\n    ```javascript\r\n        // user = { id: 6, name: 'Omar', age: '53', registeredAt: 2147483647 }\r\n        user.delete().then(function () {\r\n            console.log('done!');\r\n        });\r\n        // And it's done(gone)!\r\n    ```\r\n- `delete(table,data)`: this function deletes from a table.\r\n\r\n    **Arguments:**\r\n\r\n    table: *[string] (required)* The wanted table.\r\n\r\n    data: *[object]*\r\n    - sql: *[string]* All the sql you want to put after \"WHERE\" *(It's recommended to not put variables in this string, write `?` instead)*\r\n    - vals: *[array|simple]* The values that will replace the `?`s in order\r\n\r\n    ```javascript\r\n        T.delete('user',{sql: 'age > ?',vals: 40},function() {\r\n            T.find('user',function(users) {\r\n                console.log(users);\r\n            });\r\n        });\r\n        // output: [ { id: 7, name: 'AbuBakr', age: '36', registeredAt: null } ]\r\n    ```\r\n# Relations (Family)\r\n## One to many (Parent & Children)\r\nYou can add a property `tableName+'Id'` manually to make a tayr belong to another tayr. Or you can use this function:\r\n\r\n- `.setParent(parent)`: Sets a parent to tayr.\r\n\r\n    **Arguments:**\r\n\r\n    parent: *[tayr] (required)* The tayr to be set as parent.\r\n\r\n    ```javascript\r\n        // comment = { id: 1, text: 'I like it', posted: 2147483647 }\r\n        // user = { id: 7, name: 'AbuBakr', age: '36', registeredAt: null }\r\n        comment.setParent(user).then(function() {\r\n            console.log(comment);\r\n        });\r\n        // output: { id: 1, text: 'I like it', posted: 2147483647, userId: 7 }\r\n    ```\r\nAnd you can get the parent using this:\r\n\r\n- `.getParent(table)`: Returns the parent tayr.\r\n\r\n    **Arguments:**\r\n\r\n    table: *[string] (required)* The parent tayr table.\r\n\r\n    ```javascript\r\n        // comment = { id: 1, text: 'I like it', posted: 2147483647, userId: 7 }\r\n        comment.getParent('user').then(function(user) {\r\n            console.log(user);\r\n        });\r\n        // output: { id: 7, name: 'AbuBakr', age: '36', registeredAt: null }\r\n    ```\r\nIf you have the parent and you want to append children to it do that:\r\n\r\n- `.addChildren(table,array)`: Adds children to tayr.\r\n\r\n    **Arguments:**\r\n\r\n    table: *[string] (required)* The children's table.\r\n\r\n    array: *[array] (required)*  The objects to be stored as children.\r\n\r\n    ```javascript\r\n    // user = { id: 7, name: 'AbuBakr', age: '36', registeredAt: null }\r\n    // comments = [ { id: 1, text: 'I like it', posted: 2147483647, userId: 7 },\r\n    // { id: 2, text: 'wonderful', posted: 2147483647, userId: null } ]\r\n    user.addChildren('comment',comments).then(function(res) {\r\n        comments = res;\r\n        console.log(comments);\r\n    });\r\n    // output: [ { id: 0, text: 'I like it', posted: 2147483647, userId: 7 },\r\n    // { id: 2, text: 'wonderful', posted: 2147483647, userId: 7 } ]\r\n    ```\r\nAnd to get children:\r\n\r\n- `getChildren(table)`: Returns children of tayr.\r\n\r\n    **Arguments:**\r\n\r\n    table: *[string] (required)*  The children's table.\r\n\r\n    ```javascript\r\n        // user = { id: 7, name: 'AbuBakr', age: '36', registeredAt: null }\r\n        user.getChildren('comment').then(function(comments) {\r\n            console.log(comments);\r\n        });\r\n        // output: [ { id: 0, text: 'I like it', posted: 2147483647, userId: 7 },\r\n        // { id: 2, text: 'wonderful', posted: 2147483647, userId: 7 } ]\r\n    ```\r\n## Many to many (Cousins)\r\n\r\n*For the rest of the docs, we used an adapted copy of sakila database.*\r\n\r\nIn Tayr the many to many related tables are called cousins:\r\n\r\n- `.getCousins(cousinsTable)`: Returns the cousins list.\r\n\r\n    **Arguments:**\r\n\r\n    cousinsTable: *[string] (required)* The cousins table name.\r\n\r\n    ```javascript\r\n    T.load('film',790).then(function (film) {\r\n        film.getCousins('actor').then(function (actors) {\r\n            console.log(actors);\r\n        });\r\n    });\r\n    // output: [ { id: 28, first_name: 'WOODY', last_name: 'HOFFMAN' },\r\n    // { id: 47, first_name: 'JULIA', last_name: 'BARRYMORE' },\r\n    // { id: 55, first_name: 'FAY', last_name: 'KILMER' } ]\r\n    ```\r\n- `.setCousins(cousinsTable,newCousins)`: Replace all the current cousins by the given cousins in array.\r\n\r\n    **Arguments:**\r\n\r\n    cousinsTable: *[string] (required)* The cousins table name.\r\n\r\n    newCousins: *[array] (required)* An array of objects(not required to be tayrs).\r\n\r\n    ```javascript\r\n    T.load('film',790).then(function (film) {\r\n        var array = [\r\n            { first_name: 'JOHN', last_name: 'CENA' },\r\n            { first_name: 'GARRY', last_name: 'LEWIS' },\r\n        ];\r\n        film.setCousins('actor',array).then(function (actors) {\r\n            console.log(actors);\r\n        });\r\n    });\r\n    // output: [ { id: 214, first_name: 'GARRY', last_name: 'LEWIS' },\r\n    // { id: 213, first_name: 'JOHN', last_name: 'CENA' } ]\r\n    ```\r\n- `.addCousins(cousinsTable,newCousins)`: Works the same as `.setCousins` but without deleting the recorded cousins.\r\n\r\n    **Arguments:**\r\n\r\n    cousinsTable: *[string] (required)* The cousins table name.\r\n\r\n    newCousins: *[array] (required)* An array of objects(not required to be tayrs).\r\n\r\n    ```javascript\r\n    T.load('film',790).then(function (film) {\r\n        var array = [\r\n            { first_name: 'PETER', last_name: 'MALCOLM' },\r\n            { first_name: 'SAMUEL', last_name: 'HADINBOURG' },\r\n        ];\r\n        film.addCousins('actor',array).then(function (newActors) {\r\n            film.getCousins('actor').then(function (actors) {\r\n                console.log(actors);\r\n            });\r\n        });\r\n    });\r\n    // output: [ { id: 215, first_name: 'PETER', last_name: 'MALCOLM' },\r\n    // { id: 214, first_name: 'GARRY', last_name: 'LEWIS' },\r\n    // { id: 213, first_name: 'JOHN', last_name: 'CENA' },\r\n    // { id: 216, first_name: 'SAMUEL', last_name: 'HADINBOURG' } ]\r\n    ```\r\n- `.addCousin(cousin)`: Add a single cousin to a tayr.\r\n\r\n    **Arguments:**\r\n\r\n    cousin: *[tayr] (required)* The cousin to be added.\r\n\r\n    ```javascript\r\n    T.load('film',790).then(function (film) {\r\n        var actor = new T.tayr('actor',{ first_name: 'FRED', last_name: 'HAMILTON' });\r\n        film.addCousin(actor).then(function () {\r\n            film.getCousins('actor').then(function (actors) {\r\n                console.log(actors);\r\n            });\r\n        });\r\n    });\r\n    // output: [ { id: 215, first_name: 'PETER', last_name: 'MALCOLM' },\r\n    // { id: 214, first_name: 'GARRY', last_name: 'LEWIS' },\r\n    // { id: 213, first_name: 'JOHN', last_name: 'CENA' },\r\n    // { id: 216, first_name: 'SAMUEL', last_name: 'HADINBOURG' },\r\n    // { id: 217, first_name: 'FRED', last_name: 'HAMILTON' } ]\r\n    ```\r\n- `.removeCousin(cousin)`: Removes the cousinity(relation) between the two tayrs.\r\n\r\n    **Arguments:**\r\n\r\n    cousin: *[tayr] (required)* The cousin to be unrelated.\r\n\r\n    ```javascript\r\n    T.load('film',790).then(function (film) {\r\n        T.load('actor',217).then(function (actor) {\r\n            film.removeCousin(actor).then(function () {\r\n                film.getCousins('actor').then(function (actors) {\r\n                    console.log(actors);\r\n                });\r\n            });\r\n        });\r\n    });\r\n    // output: [ { id: 215, first_name: 'PETER', last_name: 'MALCOLM' },\r\n    // { id: 214, first_name: 'GARRY', last_name: 'LEWIS' },\r\n    // { id: 213, first_name: 'JOHN', last_name: 'CENA' },\r\n    // { id: 216, first_name: 'SAMUEL', last_name: 'HADINBOURG' } ]\r\n    ```\r\n\r\n*Note: In case you want to know whats the intermediate table name between two tables you can use this:*\r\n```javascript\r\nT.getUncleTableName(table1,table2);\r\n// for table1 = 'film' and table2 = 'actor'\r\n// it returns 'actor_film'\r\n```\r\n\r\n## Family Helpers\r\n- `findByFecundity(table,data)`: Finds rows ordered by children's number.\r\n\r\n    **Arguments:**\r\n\r\n    table: *[string] (required)* The table wanted.\r\n\r\n    data: *[object]*\r\n    - children: *[string] (required)* The children table name\r\n    - as: *[string]* The property name that contains the children's number *|| Default: children+'s'*\r\n    - limit: *[integer]* The limit number of returned rows\r\n    - poorest: *[boolean]* If true the order will be ascending *|| Default: false*\r\n    - tayrize: *[boolean]* Force result as tayrs\r\n\r\n    ```javascript\r\n    T.findByFecundity('country',{children:'city',limit:3}).then(function (countries) {\r\n        console.log(countries);\r\n    });\r\n    // output: [ RowDataPacket { id: 44, country: 'India', citys: 60 },\r\n    // RowDataPacket { id: 23, country: 'China', citys: 53 },\r\n    // RowDataPacket { id: 103, country: 'United States', citys: 35 } ]\r\n    ```\r\n    To inverse the order:\r\n    ```javascript\r\n    T.findByFecundity('country',{children:'city',limit:3,order:'less'}).then(function (countries) {\r\n        console.log(countries);\r\n    });\r\n    // output:  [ RowDataPacket { id: 84, country: 'Slovakia', citys: 1 },\r\n    // RowDataPacket { id: 81, country: 'Saint Vincent and the Grenadines', citys: 1 },\r\n    // RowDataPacket { id: 11, country: 'Bahrain', citys: 1 } ]\r\n    ```\r\n    With `as`:\r\n    ```javascript\r\n        T.findByFecundity('country',{children:'city',as:'cities',limit:3}).then(function (countries) {\r\n            console.log(countries);\r\n        });\r\n        // output: [ RowDataPacket { id: 44, country: 'India', cities: 60 },\r\n        // RowDataPacket { id: 23, country: 'China', cities: 53 },\r\n        // RowDataPacket { id: 103, country: 'United States', cities: 35 } ]\r\n    ```\r\n    If you don't want the children' number property to be returned:\r\n    ```javascript\r\n    T.findByFecundity('country',{children:'city',as:'',limit:3}).then(function (countries) {\r\n        console.log(countries);\r\n    });\r\n    // output: [ { id: 44, country: 'India' },\r\n    // { id: 23, country: 'China' },\r\n    // { id: 103, country: 'United States' } ]\r\n    ```\r\n    You can see now that the returned result is an array of tayrs, that was not the case before, because the children's number property does not exist in the original table. But if you want to force result to be an array of tayrs even if the children's number property is returned:\r\n    ```javascript\r\n    T.findByFecundity('country',{children:'city',as:'cities',limit:3,tayrize:true}).then(function (countries) {\r\n        console.log(countries);\r\n    });\r\n    // output: [ { id: 44, country: 'India', cities: 60 },\r\n    // { id: 23, country: 'China', cities: 53 },\r\n    // { id: 103, country: 'United States', cities: 35 } ]\r\n    ```\r\n- `findByCousinity(table,data)`: Finds rows ordered by cousins's number.\r\n\r\n    **Arguments:**\r\n\r\n    *(Same as `findByFecundity`)* But, write `data.cousin` instead of `data.children`.\r\n\r\n    ```javascript\r\n    T.findByCousinity('category',{cousin:'film',limit:4}).then(function (categories) {\r\n        console.log(categories);\r\n    });\r\n    // output: [ RowDataPacket { id: 15, name: 'Sports', films: 74 },\r\n    // RowDataPacket { id: 9, name: 'Foreign', films: 73 },\r\n    // RowDataPacket { id: 8, name: 'Family', films: 69 },\r\n    // RowDataPacket { id: 6, name: 'Documentary', films: 68 } ]\r\n    ```\r\n\r\n# Datatypes\r\nThese are the supported types, any other type can cause errors.\r\n- `integer`: INT *(convertible to DOUBLE automatically)*\r\n- `decimal`: DOUBLE\r\n- `boolean`: BOOL\r\n- `string` : VARCHAR (if length < 256) | TEXT (if length > 255)\r\n- `Date`   : BIGINT (in milliseconds)\r\n\r\n# Helpers\r\n\r\n## Counting\r\n\r\n- `count(table,data)`: Returns the number of rows found.\r\n\r\n    **Arguments:**\r\n\r\n    table: *[string] (required)* The table from which it will count.\r\n\r\n    data: *[object]*\r\n    - sql: *[string]* Filter\r\n    - vals: *[array|simple]*  Values that will replace `?` in `sql` property\r\n\r\n    ```javascript\r\n    T.count('film',{sql: 'length > ?',vals: 60}).then(function(res) {\r\n        console.log(res);\r\n    });\r\n    // output: 896\r\n    ```\r\n\r\n## Executing MySQL\r\n\r\n- `exec(sql,vals)`: Allows you to execute any MySql request.\r\n\r\n    **Arguments:**\r\n\r\n    sql: *[string] (required)* SQL code.\r\n\r\n    vals: *[array|simple]*  Values that will replace `?` in `sql` property\r\n\r\n    ```javascript\r\n    T.exec('SELECT title FROM film WHERE length < ?',47).then(function(res) {\r\n        console.log(res);\r\n    });\r\n    // output: [ RowDataPacket { title: 'ALIEN CENTER' },\r\n    // RowDataPacket { title: 'IRON MOON' },\r\n    // RowDataPacket { title: 'KWAI HOMEWARD' },\r\n    // RowDataPacket { title: 'LABYRINTH LEAGUE' },\r\n    // RowDataPacket { title: 'RIDGEMONT SUBMARINE' } ]\r\n    ```\r\n\r\n## Converting to tayrs\r\n\r\n- `arrayToTayrs(table,array)`: Transforms an array of simple objects to an array of tayrs.\r\n\r\n    **Arguments:**\r\n\r\n    table: *[string] (required)* The table of the future tayrs.\r\n\r\n    array: *[array] (required)* The array of object to be transformed.\r\n\r\n    ```javascript\r\n        var comments = [\r\n            {text: 'First comment!', postedAt: new Date()},\r\n            {text: 'Stop these stupid comments please!', postedAt: new Date()},\r\n            {text: 'Keep Calm', postedAt: new Date()},\r\n        ];\r\n        console.log(comments[0].table); // output: undefined\r\n        comments = T.arrayToTayrs('comment',comments);\r\n        console.log(comments[0].table); // output: comments\r\n    ```\r\n",
  "note": "Don't delete this file! It's used internally to help with page regeneration."
}